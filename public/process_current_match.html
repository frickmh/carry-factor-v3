<!DOCTYPE html>
    <head>
        <title>Carry-Factor.com - LoL Stats Command Center.  Stats, Counterpicks, and Cooldowns</title>
        <link rel="shortcut icon" href="website/diamond_i_favicon.png">
        <meta content="LoL Stats Command Center.  Scout your opponents and punish their weakest link.  Dynamic Counterpick tool." name='description'>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Pre-game Lobby Stats for League of Legends">
        <meta name="keywords" content="pre-game lobby stats, League of Legends, Champion Select, Statistics, Summoner info, Bronzodia, Bronzodia.com, stats, lol, bronzodia, carry-factor, carry factor, counterpick, counterpicks, counter power, educational, learning, tutorial, coaching, jungling, carrying, pressure ">

                <!-- Google Analytics Tracking Script -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-60328206-5', 'auto');
            ga('send', 'pageview');

        </script>

        <link href="http://fonts.googleapis.com/css?family=Corben:bold" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Nobile" rel="stylesheet" type="text/css">

        <link rel="stylesheet" type="text/css" href="stylesheets/bronzodia.css">
        <link rel="stylesheet" type="text/css" href="stylesheets/bronzodia_Dark.css" id='dark-styles'>
        <link rel="stylesheet" type="text/css" href="stylesheets/bronzodia_Light.css" id='light-styles'>

        <link rel="stylesheet" type="text/css" href="stylesheets/counterPicks.css">

        <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
        <script src="https://code.jquery.com/color/jquery.color-2.1.2.min.js"></script>-->

        <script src="src/standardFunctions.js"></script>
        <script src="src/counterPicks.js"></script>

        <script src="/ads.js"></script>
        <script src="/adsbygoogle.js"></script>
        <!--<script src="/reload/reload.js"></script>-->





        <style>

          img.center {
                  display: block;
                  margin-left: auto;
                  margin-right: auto;
          }

          .center {
              margin-left: auto;
              margin-right: auto;
              width: 115em;
          }

          .centerMasteries {
              margin: 0 auto;
          }
          
          .current_match table, .current_match td, .current_match tr {
              //border: 1px solid #BBBBBB;
              font-family: Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif;
              //font-size:.8vw;
          }
          
          tr.currentMatchPlayer:hover {
              opacity: .9;
          }
          
          tr.currentMatchPlayer:active {
              opacity: .9;
          }
          
          .placeholder {

              width: 1290px;
              height: 74px;
                
          }		

          .matchupWinRate {
             font-weight: bold;
          }

        
          .counterPower {
            font-weight: bold;
            color: blue;
          }
            
          .counterPower[data*="-"] { color: red; }
                       
                      
          table.masteriesHolder {
          
            background-color: #888888;
            
            position: fixed;

            top: 5vw;
            
            left: 20vw;
            
            opacity: .9;
            
          }



        td.masteriesHolder {

        width: 20vw;

               //height: 30vw;
               
        }



        .ferocity {

          background-color: #660000;
          
          
          text-align: centerMasteries;
          
        display: inline-block;

        }



        .cunning {

          background-color: #660066;
          
          
          text-align: centerMasteries;
          
        display: inline-block;

        }



        .resolve {

          background-color: #006600;
          
          text-align: centerMasteries;
          
        display: inline-block;

        }


            
      </style>
    </head>
    <body>

		<!--<script src = "src/jquery/jquery-2.2.4.min.js"></script>-->
		<!--<script src = "src/jquery/jquery-sortable.js"></script-->
		<!--<script src = "src/jquery/jquery-ui.min.js"></script>-->
	        <script src="/src/jquery-ui-1.12.1.custom/external/jquery/jquery.js"></script>
        	<script src="/src/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
                
		<!--<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>-->
	
	<div id='headerDiv' align='center'>		

                <div style='width: 100%;' class='brown'><a href="index.html"><img class='banner' style='width:57.65%' src='website/banner-carry-factor.png' alt='Carry-Factor.com: LoL Stats Command Center'></a></div>
                <br>



                <div id="LeaderboardTop" style='box-shadow: 10px 10px 5px rgba(50, 50, 50, .3);width:728px;height:90px;'>

                    <!-- Leaderboard Bronzodia - Google AdSense-->
                    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

                    <ins class="adsbygoogle"
                         style="display:inline-block;width:728px;height:90px"
                         data-ad-client="ca-pub-6399216573107712"
                         data-ad-slot="2427748385"></ins>
                    <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                    <!-- Large Leaderboard Top Bronzodia -->
                    <!--
                    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <ins class="adsbygoogle"
                         style="display:inline-block;width:970px;height:90px"
                         data-ad-client="ca-pub-6399216573107712"
                         data-ad-slot="2985489185"></ins>
                    <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>-->
                    <button style='float: left;' onclick="this.parentNode.remove();">X</button>
                </div>



                                <div>
                                <form style="visibility: hidden; height:1px" id='formhidden' action='results.html' method="get" target="_blank"><input name='region' id='region' value="Region"><input type='checkbox' name='scout' id='scoutHidden'><input name='playerNames' id='playerNames' value="Players"><!--<textarea name='lobbychat' id='lobbychat'>Hello!</textarea>--><input id="inputhidden" type="submit" value="Submit"></form>

                                <h3>Enter Names, then Submit.</h3>
                                        <textarea style="height: 135px; width: 25%" class="lobbyChat" id="lobbychatvisible" spellcheck="false" title='Paste chat here.  Type missing player names in a seperate line.  Non-case sensitive, ignores spaces.'>NovaDisk joined the lobby.
hashinshin joined the lobby.
Super Metroid joined the lobby.
MarineRevenge joined the lobby.
GundayMonday joined the lobby.
                                        </textarea>

                                        <div>
                                                <select id="regionvisible" onchange="setRegion()">
                                                        <option value="na1" selected="selected">NA</option>
                                                        <option value="euw1">EUW</option>
                                                        <option value="eun1">EUNE</option>
                                                        <option value="br1">BR</option>
                                                        <option value="kr">KR</option>
                                                        <option value="la1">LAN</option>
                                                        <option value="la2">LAS</option>
                                                        <option value="oc1">OCE</option>
                                                        <option value="ru">RU</option>
                                                        <option value="tr1">TR</option>
                                                        <option value="jp1">JP</option>
                                                </select>
                                        </div>
                                        <br>


                                        <button  style="height: 50px;" onclick="openResultsWindow()" class='freljord' title="Search for Pre-Game Statistics.  Detailed stats on player champion pools can be found here.">Pre-Game</button>
                                        <button  id='buttonvisible' style="height: 50px;" onclick="openNewWindow()" class='freljord' title="Search for Live-Game Statistics (Must be currently in a game).  Gives an at-a-glance table for determining each player's strengths.">Live Game</button>

                                </div>
  <div class="patchHolder">Patch: <span id='patchDisplay'>Loading...</span></div>	

                                <script>
                                        function setRegion() {
                                                var region = document.getElementById('regionvisible').value;
                                                document.cookie = "region=" + region + "; expires=Thu, 18 Dec 2020 12:00:00 UTC;";
                                                //alert (document.cookie);

                                        }

                                        if (getCookie("region") != null) {
                                                var val = getCookie("region");
                                                var sel = document.getElementById('regionvisible');
                                                var opts = sel.options;
                                                for(var opt, j = 0; opt = opts[j]; j++) {
                                                        if(opt.value == val) {
                                                                sel.selectedIndex = j;
                                                                break;
                                                        }
                                                }
                                        }
                                </script>
	</div> <!--End Header Div-->



  <div id="main_content_div" align="center">
    <div></div>
        <table>
          <tr>
            <td>
              <div id='skyscraperContainer' style='height:600px; width: 160px;margin-right: 50px; background-color: #CFDFFF'>			
			<button style='float: left;' onclick="this.parentNode.remove();">X</button>
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
				 style="display:inline-block;width:160px;height:600px; margin-right: 50px;"
				 data-ad-client="ca-pub-6399216573107712"
				 data-ad-slot="1622310788"></ins>
			<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
			</script>			
              </div>
        
                    
            </td>
            <td class='contentHolder'>
        
        

		
        <h2 style="text-align: center;" align="center">Current Match Statistics</h2>
        

                <button style='font-size: 150%'  id='iframe_closeButton' onclick="hideMasteries()" style='background-color: #888888; visibility: hidden;' class='xbutton'>X</button>
                
                
                
                <script>
                   
                    function openResultsWindow() {              
                      

                      var region = document.getElementById('regionvisible').value;


                      var formHidden = document.getElementById('formhidden');
                      var regionHidden = document.getElementById('region');
                      var playerNamesHidden = document.getElementById('playerNames')

                      var lobbyChat = document.getElementById('lobbychatvisible').value;

                      regionHidden.value = document.getElementById('regionvisible').value;

                      var lobbyChatLines = lobbyChat.split(/\r?\n/);

                      var playersList = [];

                      for (i = 0; i < lobbyChatLines.length; i++) {
                            if (lobbyChatLines[i].indexOf(':') > 0) {
                                var name = lobbyChatLines[i].split(':')[0].replace(/\s/g, '');

                                var upperCaseNames = playersList.map(function(value) {
                                return value.toUpperCase();
                                });

                                if (upperCaseNames.indexOf(name.toUpperCase()) < 0) {
                                    playersList.push(name);

                                }

                            } else if (lobbyChatLines[i].indexOf(' joined the room.') > 0) {

                                var name = lobbyChatLines[i].split(' joined the room.')[0].replace(/\s/g, '');

                                var upperCaseNames = playersList.map(function(value) {
                                return value.toUpperCase();
                                });

                                if (upperCaseNames.indexOf(name.toUpperCase()) < 0) {
                                    playersList.push(name);

                                }

                            }

                      }

                      var params = '';

                      for (i = 0; i < playersList.length; i++) {

                            params += playersList[i];


                            if (i < playersList.length - 1) {
                                params +=',';
                            } else {

                            }

                      }


                      playerNamesHidden.value = params;

                      playerNamesHidden.value = findPlayerNames(lobbyChat);

                      formHidden.submit();

                    };


                    function setCookies() {
                        alert("Starting to set cookies.");

                        var d = new Date();
                        d.setTime(d.getTime() + (90*24*60*60*1000));
                        var expires = "expires=" + d.toGMTString();

                        var e = document.getElementById("regionvisible");

                        alert("Got e.");

                        document.cookie = "username=" + document.getElementById("userName").value;

                        alert("Username added to cookie.");

                        document.cookie = "region=" + e.options[e.selectedIndex].value;

                        alert("Region added to cookie.");

                        document.cookie = expires;

                        alert("Cookies assigned.");

                        //alert(document.cookie);
                    }

                    // Arguments :
                    //  verb : 'GET'|'POST'
                    //  target : an optional opening target (a name, or "_blank"), defaults to "_self"
                    openNewWindow = function () { //function(verb, url, data, target) {

                      //alert("openNewWindow called.");

                      var formHidden = document.getElementById('formhidden');
                      var regionHidden = document.getElementById('region');
                      var lobbyChatHidden = document.getElementById('lobbychat');

                      //alert("Values assigned.");

                      regionHidden.value = document.getElementById('regionvisible').value;

                      //alert(regionHidden.value);

                      console.log(document.getElementById('lobbychatvisible'));

                      //lobbyChatHidden.value = document.getElementById('lobbychatvisible').value;

                      playerNamesHidden.value = findPlayerNames(lobbyChat);

                      //alert(lobbyChatHidden.value);

                      formHidden.setAttribute("target", "_self");
                      formHidden.setAttribute("action", "process_current_match.html");

                      formHidden.submit();

                      //alert("Submit attempted.");

                      document.getElementById('buttonvisible').innerHTML = "Loading...";
                      document.getElementById('buttonvisible').disabled = true;


                    };

					
                    //alert(document.getElementById('postDataContinuePlayer').value);
                    

                </script>
  <script>
    var myUrl = 'getCurrentGameJSON?region=' + getUrlParameter('region') + '&names=' + getUrlParameter('playerNames');
    //var myUrl = '/sampleCurrentGameJSON2.json';

    console.log(myUrl);

    $( document ).ready(function() {
      console.log("Document ready!");

      addWall();

      //Main control function which uses JSON data for all players to generate a graphical diaplay table.
      $.ajax({
          url: myUrl,
          type: 'GET',
          success: function(data){
              //Patch Display
              $("#patchDisplay").html(data.patch);
              console.log(data);

              console.log(data.players);
              
              $("#lobbychatvisible").html(getUrlParameter('playerNames'));      

              //Gather all JSON at the beginning of the Ajax call.
              var sspellAjax = $.getJSON("/datadragon/" + data.patch + "/data/en_US/summoner.json");
              var runeAjax = $.getJSON("/datadragon/" + data.patch + "/data/en_US/rune.json");
              var perkAjax = $.getJSON("/datadragon/perksById.json");
              var masteryAjax = $.getJSON("/datadragon/" + data.patch + "/data/en_US/mastery.json");
              var champSpellAjax = $.getJSON("/data/champSpells.json");
              var championsSummaryAjax = $.getJSON("/data/championsSummary.json");
              var champsListByIdAjax = $.getJSON("./data/champsList.json");
              
              $.when(sspellAjax, runeAjax, perkAjax, masteryAjax, champSpellAjax, championsSummaryAjax, champsListByIdAjax).done(function(sspellJSON, runeJSON, perkJSON, masteryJSON, champSpellJSON, championsSummaryJSON, champsListByIdJSON){
                console.log(sspellJSON);                  
              
                var tableTeam = $(".tableTeam:eq(0)").clone();

                tableTeam.appendTo("#tableHolder");
              
                var teams = {};

                //Initialize Players object.
                for (var player in data.players)
                {
                  var teamId = data.players[player].teamId;

                  if (teams[teamId] == undefined)
                  {
                    teams[teamId] = {};
                    teams[teamId].players = {};
                  }
                  
                  teams[teamId].players[player] = player;

                }
                //console.log(teams);

                var i = 0;

                
                for (var team in teams) {
                  var j = 0;

                  //console.log(team);

                  $(".tableTeam:eq(" + i + ")").attr("class", "tableTeam " + team);
                  i++;

                }

                //Clone empty table rows (Will fill below)
                $.each(teams, function(index, value) {
                    //console.log(index);
                    //console.log(value);
                    //console.log(teams);

                    for (var i = 0; i < Object.keys(value.players).length - 1; i++) {

                      var rowPlayer = $("." + index + " .currentMatchPlayer:eq(0)").clone();
                      //console.log(rowPlayer);
                      rowPlayer.appendTo("." + index);
                    }
                });

                var playerCount = Object.keys(data.players).length;

                //Main loop where we fill each divider in each table row with output.
                for (var i = 0; i < playerCount; i++) {
                  var playerRow = $(".currentMatchPlayer:eq(" + i + ")");
                  playerRow.attr('name', i);
                  
                  //console.log(data.players[i]);

                  var player = data.players[i];


                  //Build Champ Portrait and Summoner Spells.
                  $(".champPortraitMain:eq(" + i + ")").attr("src", "/datadragon/" + data.patch + "/img/champion/" + player.champion.key + ".png");
                  $(".champPortraitMain:eq(" + i + ")").attr("title", player.champion.name);
                  $(".champPortraitMain:eq(" + i + ")").attr("alt", player.champion.key + ".png");
                  $(".champPortraitMain:eq(" + i + ")").parent().attr("href", "http://leagueoflegends.wikia.com/wiki/" + player.champion.key);

                  $.each(sspellJSON[0].data, function(index, sspell) {
                    if (sspell.key == player.spells[0]) {
                      $(".sspell1:eq(" + i + ")").attr("src", "/datadragon/" + data.patch + "/img/spell//" + sspell.id + ".png");
                      $(".sspell1:eq(" + i + ")").attr("title", sspell.name + " (" + sspell.cooldownBurn + "s)");
                    }
                    if (sspell.key == player.spells[1]) {
                      $(".sspell2:eq(" + i + ")").attr("src", "/datadragon/" + data.patch + "/img/spell//" + sspell.id + ".png");
                      $(".sspell2:eq(" + i + ")").attr("title", sspell.name + " (" + sspell.cooldownBurn + "s)");
                    }
                  });

                      
                      
                  //Build Champ Name.
                  $(".champNameContainer:eq(" + i + ")").html(player.champion.name);

                  $(".nameContainer:eq(" + i + ")").html(player.name);
                  $(".nameContainer:eq(" + i + ")").attr('href', "https://" + opggRegion(data.region) + ".op.gg/summoner/userName="  + player.name);
                  

                  //Build Recent Roles played in the last 20 games.
                  buildPositions(player, champsListByIdJSON[0]);

                  //console.log(player);

                  $(".recentRoles:eq(" + i + ")").html('');

                  var tableRecentRoles = $('<table></table>').addClass('tableRecentRoles');
                  $.each(player.positions, function(j, position) {
                        var row = $('<tr></tr>').addClass('rolesRow').text(j + ': ' + Math.round(position.count * 100.0 / player.matchCount) + "%");
                        row.attr('data-positioncount', position.count);
                        tableRecentRoles.append(row);
                  });

                  $(".recentRoles:eq(" + i + ")").append(tableRecentRoles);


                  if (player.leagues.tier != undefined) {
                    //Build League info including rank, with icon.
                    $(".leagueIcon:eq(" + i + ")").attr("src", "/rankicons/" + player.leagues.tier + "_" + player.leagues.rank + ".png");
                    $(".leagueIcon:eq(" + i + ")").attr("title", player.leagues.tier.charAt(0)+ player.leagues.tier.slice(1).toLowerCase() + " " + player.leagues.rank);
                    $(".leagueIcon:eq(" + i + ")").attr("alt", player.leagues.tier.charAt(0) + player.leagues.tier.slice(1).toLowerCase() + " " + player.leagues.rank);
                  } else { 
                    $(".leagueIcon:eq(" + i + ")").attr("src", "/rankicons/unranked.png");
                    $(".leagueIcon:eq(" + i + ")").attr("title", "Unranked");
                    $(".leagueIcon:eq(" + i + ")").attr("alt", "Unranked");
                  }

                  $(".playerRank:eq(" + i + ")").html(buildRank(player));
                  
                  $(".seasonWinLoss:eq(" + i + ")").html(player.leagues.wins + "/" + player.leagues.losses);

                  //console.log(player);
                  
  

                  //Build table containing scores, champ played, and outcome for each of the last 10 games.
                  var trRecentWins = $('<tr></tr>').addClass('tableRecentWins');
                  trRecentWins.addClass('slot' + i);

                  var matches = data.matches;

		  var playerMatches = [];

		  //Iterate through the matches, adding any matches where the player fits to playerMatches.
		  for (var j = 0; j < matches.length; j++) {
		    for (var k = 0; k < 10; k++) {
            //console.log("k loop");
            //console.log(matches[j]["summonerId" + k]);
		      if (matches[j]["summonerId" + k] == player.summonerId) {
            //console.log(champsListByIdJSON[0]);
            //console.log(matches[j]["champId" + k]);

            var match = { "champ" : champsListByIdJSON[0].data[matches[j]["champId" + k]], "kills" : matches[j]["kills" + k], "deaths" : matches[j]["deaths" + k], "assists" : matches[j]["assists" + k], "win" : matches[j]["win" + k].data[0], "gameCreation" : matches[j].gameCreation, "gameId" : matches[j].gameId}; 
            //console.log(match);
            playerMatches.push(match);

		      }
		    }
		  }

		  function compare(a,b) {
		      if (a.gameCreation > b.gameCreation)
			    return -1;
			if (a.gameCreation < b.gameCreation)
			      return 1;
			  return 0;
		  }

		  playerMatchesFull = playerMatches;
                  
      playerMatches.sort(compare);

		  playerMatches = playerMatches.slice(0,10);


      var playerMatchesToUpdate = [];


		  var matchList = (player.matchList != undefined && player.matchList.status == undefined ) ? player.matchList.matches : {};

		  //Now we need to combine player.matchList with playerMatches, so we can update them later.
		  for (var j = 0; j < matchList.length; j++) {
		    var matchFound = false;
		    for (var k = 0; k < playerMatches.length; k++) {
		      if (playerMatches[k].gameId == matchList[j].gameId) {
			matchFound = true;
			//console.log("Found!");

		      }
		    }
		    if (!matchFound) {
		      var match = { "champ" : champsListByIdJSON[0].data[matchList[j].champion], "gameCreation" : matchList[j].timestamp / 1000, "gameId" : matchList[j].gameId, "toUpdate" : true};

		      //console.log("Not found, adding!");

          match.slot = j;
		      playerMatches.push(match);
		    }

		  }


		  playerMatches.sort(compare);

		  playerMatches = playerMatches.slice(0,10);

		  if (playerMatches == undefined)
		    return;



                  $.each(playerMatches, function(j, match) {

                      if (match.toUpdate == true)
                        playerMatchesToUpdate.push(match);

                      var outcome = match.win != undefined ? (match.win ? "win" : "loss") : "unknown";

                      var td = $('<td></td>').addClass(outcome);

                      var date = new Date(match.gameCreation * 1000);
                      var offset = date.getTimezoneOffset();

                      var dateString = (date.getHours() % 12 != 0 ? date.getHours() % 12 : 12) + ":" + (date.getMinutes() < 10 ? "0" : "") + date.getMinutes() + (date.getHours() < 12 ? "am" : "pm") + " on " + (date.getMonth() + 1) + "/" + date.getDate() + "/" + date.getFullYear();

                      td.attr('style', 'width:.6vw;height:.6vw;font-size:100%;border: 1px solid #BBBBBB;text-align:center;cursor:default;');
 
                      if (outcome != "unknown") {
                        td.attr('title', match.kills + "/" + match.deaths + "/" + match.assists + " " + match.champ.name + " " + outcome + " at " + dateString);
                      } else {
                        td.attr('title', "No match data for game at " + dateString + ".");                        
                      }

                      var img = $('<img>').addClass('champPortrait');
                      //img.attr('src', "/datadragon/" + data.patch + "/img/champion/" + match.champ.key + ".png");
                      img.attr('src', "/images/champs/" + match.champ.key + ".png");
                      img.attr('style', 'width:.9vw; display:block;');

                      td.append(img);

                      trRecentWins.append(td);

                      if (match.toUpdate != undefined) {

                        console.log(match);

                        urlUpdate = "enterGameAndRetrieve?region=" + data.region + "&match=" + match.gameId + "&champ=" + match.champ.id;

                        /*

                        $.ajax({
                          url: urlUpdate,
                          type: 'GET',
                          slot: i,
                          index: j,
                          champname: match.champ.name,
                          dateString: dateString,
                          success: function(data) {
                            //console.log(data);
                                              //console.log(this);
                            var tdMatch = $(".tableRecentWins.slot" + this.slot + " td:eq(" + (this.index) + ")");

                            //console.log(data.match.win);

                            if (data.match != undefined) {
                              tdMatch.removeClass("unknown");
                              tdMatch.addClass(data.match.win == 1 ? "win" : "loss");

                              tdMatch.attr("title", data.match.kills + "/" + data.match.deaths + "/" + data.match.assists + " " + this.champname + " " + (data.match.win == 1 ? "win" : "loss") + " at " + this.dateString);
                            } else {
                              console.error("Problem fetching URL: " + this.url);
                              console.error(data);
                            }


                            //console.log(tdMatch[0]);

                          }

                        });

                        */

                      }


                  });

 
                  console.log(data.region);
                  console.log(playerMatchesToUpdate);

                  var urlUpdate = "enterMultipleGamesAndRetrieve?region=" + data.region + "&matches=" + JSON.stringify(playerMatchesToUpdate);

                  console.log(urlUpdate);

                  
                  $.ajax({
                    url: urlUpdate,
                    type: 'GET',
                    slot: i,
                    matches: playerMatches,
                    //dateString: dateString,
                    success: function(data) {

											console.log("Ajax Success!");
											console.log(data);
											console.log(this.slot);
											console.log(this.matches);
  
											for (match in this.matches) {

												//console.log(data[this.matches[match].gameId].champIds[this.matches[match].champ.id]);

												var gameId = this.matches[match].gameId;

												//console.log(match);
												//console.log(gameId);

												if (data.matches[gameId] == undefined)
													continue;

												var ajaxMatchData = data.matches[gameId].champIds[this.matches[match].champ.id];

												//console.log(ajaxMatchData);

												this.matches[match].kills = ajaxMatchData.kills;
												this.matches[match].deaths = ajaxMatchData.deaths;
												this.matches[match].assists = ajaxMatchData.assists;
												this.matches[match].win = ajaxMatchData.win;
												this.matches[match].toUpdate = false;

                        var tdMatch = $(".tableRecentWins.slot" + this.slot + " td:eq(" + (ajaxMatchData.slot) + ")");

                        //console.log(tdMatch);

                        if (data.matches[gameId] == undefined)
                          continue;

												//tdMatch.find("img:eq(0)").attr("title", tdMatch.find("img:eq(0)").attr("title").replace("unknown", ajaxMatchData.win == 1 ? "win" : "loss"));
												tdMatch.removeClass("unknown");
												tdMatch.addClass(ajaxMatchData.win == 1 ? "win" : "loss");

                        var titleOld = tdMatch.attr("title");

                        var titleNew = titleOld.replace("No match data for game", ajaxMatchData.kills + "/" + ajaxMatchData.deaths + "/" + ajaxMatchData.assists + " " + this.matches[match].champ.name + (ajaxMatchData.win == 1 ? " win" : " loss"));

                        tdMatch.attr("title", titleNew);

												//tdMatch.attr("title", data.match.kills + "/" + data.match.deaths + "/" + data.match.assists + " " + this.champname + " " + (data.match.win == 1 ? "win" : "loss"));





                        /*
												var tdMatch = $(".matchScoresHolder.slot" + this.slot + " td:eq(" + (ajaxMatchData.slot + 1) + ")");



												tdMatch.removeClass("unknown");
												tdMatch.addClass(ajaxMatchData.win == 1 ? "win" : "loss");

												tdMatch.find("div:eq(1)").html(ajaxMatchData.kills + "<br>" + ajaxMatchData.deaths + "<br>" + ajaxMatchData.assists);

												tdMatch.find("img:eq(0)").attr("title", tdMatch.find("img:eq(0)").attr("title").replace("unknown", ajaxMatchData.win == 1 ? "win" : "loss"));

												console.log(tdMatch);

                        */

											}

                    
                    
                    }
                  });

                  
                





                  $(".recentWins:eq(" + i + ") > tbody").append(trRecentWins);

                  //console.log(playerMatchesFull);


		  var playerChamps = {};

		  //console.log(playerMatchesFull);

		  for (var j = 0; j < playerMatchesFull.length; j++) {
		    //If stats do not exist for a champ, create a new champ and initialize it's stats.
		    if (playerChamps[playerMatchesFull[j].champ["key"]] == undefined) {
		      playerChamps[playerMatchesFull[j].champ["key"]] = { "champ" : playerMatchesFull[j].champ, "wins" : playerMatchesFull[j].win, "games" : 1, "kills" : playerMatchesFull[j].kills, "deaths" : playerMatchesFull[j].deaths, "assists" : playerMatchesFull[j].assists};
		    } else {
		      playerChamps[playerMatchesFull[j].champ["key"]].wins += playerMatchesFull[j].win;
		      playerChamps[playerMatchesFull[j].champ["key"]].games += 1;
		      playerChamps[playerMatchesFull[j].champ["key"]].kills += playerMatchesFull[j].kills;
		      playerChamps[playerMatchesFull[j].champ["key"]].deaths += playerMatchesFull[j].deaths;
		      playerChamps[playerMatchesFull[j].champ["key"]].assists += playerMatchesFull[j].assists;


		    }
		  }


                  //console.log(playerChamps);


                  //Build stats - KDA, games played, Win Percent
                  var gamesPlayedContainer = $(".gamesPlayedContainer:eq(" + i + ")");
                  var kdaContainer =  $(".kdaContainer:eq(" + i + ")");
                  var winPctContainer =  $(".winPctContainer:eq(" + i + ")");

                  var games = playerChamps[player.champion.key] != undefined ? playerChamps[player.champion.key].games : 0;
                  var wins = playerChamps[player.champion.key] != undefined ? playerChamps[player.champion.key].wins : 0;
                  var kills = playerChamps[player.champion.key] != undefined ? playerChamps[player.champion.key].kills : 0;
                  var deaths = playerChamps[player.champion.key] != undefined ? playerChamps[player.champion.key].deaths : 0;
                  var assists = playerChamps[player.champion.key] != undefined ? playerChamps[player.champion.key].assists : 0;


                  //console.log(games);

                  //console.log(gamesPlayedContainer[0]);

                  //gamesPlayedContainer.html("(" + games + ")");
                  gamesPlayedContainer.html("(" + games + ")");

                  //var kdaContainer =  $(".kdaContainer:eq(" + this.slot + ")");

                  var kdaString;

                  if (deaths == 0) {
                    kdaString = Math.round(100.0 * (kills + assists)) / 100.0;
                  } else {
                    kdaString = Math.round(100.0 * (kills + assists) / deaths) / 100.0;
                  }

                  //console.log(kdaContainer[0]);
                  //console.log("Slot " + this.slot + ": " + data.kills + ", " + data.deaths + ", " + data.assists);

                  //kdaContainer.html(kdaString + " ");

                  //<span class='tooltip' title='$everyoneKillsPerGame[$k]/$everyoneDeathsPerGame[$k]/$everyoneAssistsPerGame[$k]'>+</span>
                  //var kdaTooltip = $("<span/>").addClass("tooltip");
                  //kdaTooltip.html("+");
                  //ikdaTooltip.attr("title", Math.round(10.0 * kills / games) / 10.0 + "/" + Math.round(10.0 * deaths / games) / 10.0 + "/" + Math.round(10.0 * assists / games) / 10.0);


                  var kdaTooltip = "<span class='tooltip' title='" + Math.round(10.0 * kills / games) / 10.0 + "/" + Math.round(10.0 * deaths / games) / 10.0 + "/" + Math.round(10.0 * assists / games) / 10.0 + "'>+</span>";



                  kdaContainer.html(kdaString + " " + kdaTooltip);

                  //var winPctContainer =  $(".winPctContainer:eq(" + this.slot + ")");

                  var winPctString = games != 0 ? Math.round(100 * 10.0 * wins / games) / 10.0 : 0;
                  //winPctContainer.html(winPctString + " %<br>(" + games + ")");
                  winPctContainer.html(winPctString + " %<br>(" + games + ")");




                  //Build Runes display.
                  var tableRunesDisplay = $('<table></table>').addClass('tableRunesDisplay');

                  //console.log(runeJSON);

                  console.log(perkJSON[0]);
                  console.log(player.perks);
                  

                  $.each(player.perks.perkIds, function(j, perk) {
                    console.log(perk);
                    console.log(perkJSON[0][perk + ""]);

                    var mPerk = perkJSON[0][perk + ""];

                    var tr = $('<tr></tr>');

                    var span = $('<span></span>').html(mPerk.name);

                    var tooltipPerk = $('<span></span>').addClass('tooltip');

                    tooltipPerk.attr("title", perk + " " + mPerk.longDesc);

                    var style = 0;

                    if (j < 4) 
                      style = player.perks.perkStyle;
                    else
                      style = player.perks.perkSubStyle;

                    console.log(style);

                    switch(style) {
                      case 8000: //Precision, Yellow
                        tooltipPerk.css("background-color", "#BBBB00");
                        break;
                      case 8100: //Domination, Red
                        tooltipPerk.css("background-color", "#AA0000");
                        break;
                      case 8200: //Sorcery, Blue
                        tooltipPerk.css("background-color", "#110099");
                        break;
                      case 8300: //Inspiration, Cyan
                        tooltipPerk.css("background-color", "#00EEEE");
                        break;
                      case 8400: //Resolve, Green
                        tooltipPerk.css("background-color", "#008800");
                        break;
                      default:
                        break;


                    }


                    tooltipPerk.css("width", "10px");
                    tooltipPerk.css("height", "10px");

                    tr.append(tooltipPerk);

                    tr.append(span);

                    tableRunesDisplay.append(tr);

									});


                  $.each(player.runes, function(j, rune) {
                      var tr = $('<tr></tr>');


                      var span = $('<span></span>').html(rune.count + "x " + runeJSON[0].data[rune.runeId].description);


                      //console.log(rune);

                       var img = $('<img>');

                      switch ( runeJSON[0].data[rune.runeId].rune.type) {
                        case "red":
                          img = img.attr('src', "/images/rune_red.png");
                          break;
                        case "blue":
                          img = img.attr('src', "/images/rune_blue.png");
                          break;
                        case "yellow":
                          img = img.attr('src', "/images/rune_yellow.png");
                          break;
                        case "black":
                          img = img.attr('src', "/images/rune_quint.png");
                          break;
                        default:
                          break;

                      }
                      //img = img.attr('src', "/datadragon/" + data.patch + "/img/rune/" + runeJSON[0].data[rune.runeId].image.full);
                      img.attr('style', 'width: 1.0vw;');
                      img.attr('title', runeJSON[0].data[rune.runeId].name);

                      tr.append(img);
                      tr.append(span);

                      tableRunesDisplay.append(tr);

                  });

                  $(".runesDisplay:eq(" + i + ")").append(tableRunesDisplay);


                  //Build Masteries display.
                  var masteriesDisplay = $(".masteriesDisplay:eq(" + i + ")");

                  //console.log(masteriesDisplay);


                  var ferocityCount = 0;
                  var cunningCount = 0;
                  var resolveCount = 0;

                  $.each(player.masteries, function(j, mastery) {
                      if (String(mastery.masteryId).charAt(1) == '1') {
                          ferocityCount += mastery.rank;
                      }
                      if (String(mastery.masteryId).charAt(1) == '2') {
                          resolveCount += mastery.rank;
                      }
                      if (String(mastery.masteryId).charAt(1) == '3') {
                          cunningCount += mastery.rank;
                      }
                      if (String(mastery.masteryId).charAt(2) == '6') {
                        //console.log(masteryJSON[0]);
                        var keystoneDisplay = $(".keystoneDisplay:eq(" + i + ")");
                        keystoneDisplay.attr('src', "datadragon/" + data.patch + "/img/mastery/" + masteryJSON[0].data[mastery.masteryId].image.full);
                        keystoneDisplay.attr('title', masteryJSON[0].data[mastery.masteryId].name + ": " + masteryJSON[0].data[mastery.masteryId].description);
                      }

                      //console.log(player.name + " " + mastery.masteryId + " == 6241? " + (mastery.masteryId == 6241));
                      if (mastery.masteryId == 6241) {
                        $(".insightDisplay:eq(" + i + ")").html('\u2714');
                      } 
                      

                    });

                  masteriesDisplay.attr('name', i);
                  masteriesDisplay.click( 
                      function(){ 
                        loadMasteries(masteryJSON[0], data, this); 
                        showMasteries(); 
                        console.log(param1);
                        });

                  masteriesDisplay.attr('value', ferocityCount + "/" + cunningCount + "/" + resolveCount);
                  masteriesDisplay.html(ferocityCount + "/" + cunningCount + "/" + resolveCount);

                   

                  //Build Spell Cooldowns display.
                  var cooldownDisplay = $(".cooldownDisplay:eq(" + i + ")");

                  cooldownDisplay.html('');

                  //console.log(cooldownDisplay);
                  //console.log(champSpellJSON[0]);

                  //console.log(champSpellJSON[0]);
                  //console.log(champSpellJSON[0].data[player.champion.key]);
                  $.each(champSpellJSON[0].data[player.champion.key].spells, function(j, spell) {
                      //console.log(spell.key);

                      var spellHolder = $('<div></div>');

                      var letter = "o";
                      if (j == 0) { letter = "Q"; }
                      if (j == 1) { letter = "W"; }
                      if (j == 2) { letter = "E"; }
                      if (j == 3) { letter = "R"; }

                      var cdDiv = $('<div></div>').html(letter + ": " + spell.cooldownBurn);
                      cdDiv.attr('style', 'display:inline-block');

                      var cdSpan = $('<span></span>').addClass('tooltip');
                      cdSpan.html('+');
                      cdSpan.attr('title', spell.description);

                      spellHolder.append(cdSpan);
                      spellHolder.append(cdDiv);

                      cooldownDisplay.append(spellHolder);


                  });


                  //Add names to the table, so they can be referenced later by 'getCounterData()'
                  var counterPowerDisplay = $(".counterPowerDisplay:eq(" + i + ")");
                      
                  counterPowerDisplay.attr('name', player.champion.key);

                  //console.log(counterPowerDisplay.attr('name'));

                  $(".currentMatchPlayer:eq(" + i + ")").attr("data-champName", player.champion.key);


                }

                sortRoles();

                //Order the rows by most played frequency according to champion.gg.
                //Once per team.
                for (var j = 0; j < 2; j++){

                  //Array containing the 5 roles.  Roles will be spliced from this array as we iterate through.
                  var rolesRemaining = [ "Top", "Jungle", "Middle", "ADC", "Support" ];

                  //For each role remaining, we search all players below index i to find the 
                  //greatest play percent by role out of the remaining champions.
                  //This champion is then swapped with the topmost searched index (at index i),
                  //the role is removed from rolesRemaining, 
                  //and as i increases, it will be omitted from further searches.
                  $.each(rolesRemaining, function(i, role){

                      var greatestPctPlayed = 0;
                      var playerToSwapUp;

                      $.each($(".current_match_tbody:eq(" + j + ") > tr") , function(team, trPlayer) {
       

                          //console.log(championsSummaryJSON[0]);
                          //console.log(trPlayer.getAttribute('data-champName'));

                          if (championsSummaryJSON[0][trPlayer.getAttribute('data-champName')] != undefined) {
                              
                            var checkRole = championsSummaryJSON[0][trPlayer.getAttribute('data-champName')].role;

                            if (checkRole[rolesRemaining[0]] != undefined) {

                              if (checkRole[rolesRemaining[0]].percentPlayed > greatestPctPlayed) {
                                greatestPctPlayed = checkRole[rolesRemaining[0]].percentPlayed;
                                playerToSwapUp = trPlayer;
                              }

                            }
                          }

                      });

                      var playerToSwapDown = $(".current_match_tbody:eq(" + j + ") > tr")[i];

                      if (playerToSwapUp != undefined && playerToSwapDown != undefined) {
                        swapNodes(playerToSwapUp, playerToSwapDown);
                      }

                      //Remove the role being tested from the remaining roles list.
                      rolesRemaining.splice(0, 1);
                  });
                }

                getCounterData();

                buildAverageRank(data);

                init_sortable();


              });  //end when
          },  //end success
          error: function(errData) {
              //alert('woops!'); //or whatever
	      console.log(errData);
	      if (errData.status == 429) {
		alert("You've made too many page requests, please try again in a few minutes.");
              }

          }
      }).fail(function(){
        var failMessage = $("<h1/>");

        var failSubtitle = $("<h3/>");

        var patchHolder = $(".patchHolder");

        failMessage.html("Match Not Found!");

        failSubtitle.html("Please check Name and Region, then Retry.");

        failMessage.appendTo(patchHolder);

        failSubtitle.appendTo(patchHolder);
        

      }); //end ajax

    }); //end readya


   function swapNodes(a, b) {
     var aparent = a.parentNode;
     var asibling = a.nextSibling === b ? a : a.nextSibling;
     b.parentNode.insertBefore(a, b);
     aparent.insertBefore(b, asibling);
   }

  //Build matchlist, and store some simple data (Role count)
  //0 is the most recent match.
  function buildPositions(player, champNamesByIdJSON) {
    //console.log(data);

    if (player == undefined || player.matchList == undefined || player.matchList.status != undefined && (player.matchList.status.status_code >= 400))
      return;

    player.positions = {};
    player.matchCount = 0;


    for (var j = 0; j < 20; j++) {
      var match = player.matchList.matches[j];
      //console.log("Match: " + match);

      if (match == undefined)
        continue;

      player.matchCount++;

      var role = "";
      if (match.lane == 'BOTTOM') {
	role = match.role == 'DUO_CARRY' ? 'ADC' : 'Support';
      } else {
	role = match.lane;
	role = role.charAt(0) + role.slice(1).toLowerCase();
      }

      if (player.positions[role] == undefined) {
	player.positions[role] = {};
	player.positions[role].champs = {};
	player.positions[role].count = 1;
      } else {
	player.positions[role].count++;
      }

      var championId = match.champion;
      //console.log("Champion ID: " + championId);

      if (player.positions[role].champs[championId] == undefined ||
	  player.positions[role].champs[championId] == 0) {
	player.positions[role].champs[championId] = {};
	player.positions[role].champs[championId].count = 1;

	//console.log(champNamesByIdJSON);

	player.positions[role].champs[championId].key = champNamesByIdJSON.data[championId].key;
	player.positions[role].champs[championId].name = champNamesByIdJSON.data[championId].name;
      } else {
	player.positions[role].champs[championId].count++;
      }

      //Sort champs here.  Just kidding, we are going to sort them in jQuery where the sort function already exists.

    }
    //console.log(output.players[i].positions);
    //console.log(output.players[i].matches);

    return player;
  }

   function buildAverageRank(allPlayersJSON) {

     //console.log(allPlayersJSON);

     var rankSum = 0;
     var rankedPlayerCount = 0;

     $.each(allPlayersJSON.players, function(playerKey, playerValue) {

         //console.log(playerValue);

         if (playerValue.leagues == undefined || playerValue.leagues.tier == undefined || playerValue.leagues.tier.toLowerCase() == "unranked") {
           return true;
         }


          switch (playerValue.leagues.tier) {
              case "BRONZE":
                  rankedPlayerCount++;
                  break;
              case "SILVER":
                  rankSum += 500;
                  rankedPlayerCount++;
                  break;
              case "GOLD":
                  rankSum += 1000;
                  rankedPlayerCount++;
                  break;
              case "PLATINUM":
                  rankSum += 1500;
                  rankedPlayerCount++;
                  break;
              case "DIAMOND":
                  rankSum += 2000;
                  rankedPlayerCount++;
                  break;
              case "MASTER":
                  rankSum += 2500;
                  rankedPlayerCount++;
                  break;
              case "CHALLENGER":
                  rankSum += 2500;
                  rankedPlayerCount++;
                  break;
              default:
                  break;
          }
          
          var tier = playerValue.leagues.tier;
          
          if (tier == "BRONZE" || tier == "SILVER" || tier == "GOLD" || tier == "PLATINUM" || tier == "DIAMOND") {
              switch (playerValue.leagues.rank) {
              case "IV":
                  rankSum += 100;
                  break;
              case "III":
                  rankSum += 200;
                  break;
              case "II":
                  rankSum += 300;
                  break;
              case "I":
                  rankSum += 400;
                  break;
              default:
                  break;
              }
          }

     });

     console.log(rankSum);

     console.log(rankedPlayerCount);

     var rankAvg = rankedPlayerCount != 0 ? 1.0 * rankSum / rankedPlayerCount : undefined;
    
     rankPrint = "Unranked";
     lpPrint = 0;
     
     

     if (rankAvg > 3000)
     {
         rankPrint = "Challenger I";                    
         lpPrint = rankAvg - 2500;
     } else if (rankAvg > 2500) {
         rankPrint = "Master I";                    
         lpPrint = rankAvg - 2500;
     }

     

      
     if (rankAvg > 0 && rankAvg < 2500) {
         if (rankAvg >= 2000) {
             rankPrint = "Diamond";
         } else if (rankAvg >= 1500) {
             rankPrint = "Platinum";
         } else if (rankAvg >= 1000) {
             rankPrint = "Gold";
         } else if (rankAvg >= 500) {
             rankPrint = "Silver";
         } else if (rankAvg > 0) {
             rankPrint = "Bronze";
         }
          
         switch (Math.floor((rankAvg % 500) / 100)) {
             case 0: rankPrint += " V";
                 break;
             case 1: rankPrint += " IV";
                 break;
             case 2: rankPrint += " III";
                 break;
             case 3: rankPrint += " II";
                 break;
             case 4: rankPrint += " I";
                 break;
             default:
                 break;
         }

         lpPrint = Math.floor(rankAvg % 100);

          
     }
      
      
     if (lpPrint != undefined) {
         lpPrint = Math.floor(lpPrint);
     }
      
     if (rankAvg != undefined) {
         rankAvg = round1(rankAvg);
     }

     
     console.log(lpPrint);

     console.log(rankPrint);

     var avgRankImg = $("<img\>");

     var avgRankHolder = $(".avgRankHolder");

     avgRankImg.attr("src", "/rankicons/" + rankPrint.replace(" ", "_").toLowerCase() + ".png");

     avgRankImg.css("width", "2vw");
     avgRankImg.css("vertical-align", "text-center");

     avgRankImg.appendTo(avgRankHolder);

     var avgRankText = $("<span/>");

     avgRankText.html(" " + rankPrint + " " + lpPrint + " LP");

     avgRankText.appendTo(avgRankHolder);




   }


  //Generates a string containing the player's rank (example format: Diamond V (55 LP))
  function buildRank(player) {
    if (player.leagues == undefined || player.leagues.tier == undefined || player.leagues.tier.toLowerCase() == "unranked")
      return "Unranked (0 LP)";

      var lp;

      //Add Miniseries if present, else display LP/
      if (player.leagues.miniSeries != undefined) {
        lp = player.leagues.miniSeries.progress;
        lp = lp.replaceAll("W", "<font style='color:green; font-size:.6vw; margin-left:-.12vw; margin-right:-.12vw;'>&#x2714;</font>&nbsp");
        lp = lp.replaceAll("L", "<font style='color:red; font-size:.6vw; margin-left:-.12vw; margin-right:-.12vw;'>&#x2716;</font>&nbsp");

        lp = lp.replaceAll("N", "<font style='color:grey; font-size:.6vw; margin-left:-.12vw; margin-right:-.12vw;'>&#x2796;</font>&nbsp");
          } else {
            lp = player.leagues.leaguePoints + " LP";           
          }
      return player.leagues.tier[0] + player.leagues.tier.slice(1).toLowerCase() + " " + player.leagues.rank.toUpperCase() + "<br>(" + lp + ")";
     
  }

  function sortRoles() {

    //Sort rows by frequency.
    for (var i = 0; i < $('.recentRoles').length; i++) {
      var $rolesTable = $('.tableRecentRoles:eq(' + i + ')');

      $rolesTable.find('.rolesRow').sort(function(a, b) {
        return +b.dataset.positioncount - +a.dataset.positioncount;
      })
      .appendTo($rolesTable);

    }
  }

  function loadMasteries(masteriesGlobalJSON, data, myObj) {
//Print Masteries List.  Debugging only.

    //console.log(masteriesGlobalJSON);
    //console.log(data.players[myObj.name]);

    var player = data.players[myObj.name];

    $("<table/>", {      
      html: "<tbody><tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr></tbody>",
      "class": "centerMasteries"
      }).appendTo('#ferocityHolder');

    $("<table/>", {
      html: "<tbody><tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr></tbody>",
      "class": "centerMasteries"
      }).appendTo('#cunningHolder');

    $("<table/>", {
      html: "<tbody><tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr>"
      + "<tr><td></td><td></td><td></td></tr></tbody>",
      "class": "centerMasteries"
      }).appendTo('#resolveHolder');

    //Initialize the mastery structure.
    
    var masteriesAssigned = {};

    masteriesAssigned['points'] = {};
    masteriesAssigned['trees'] = {};
    masteriesAssigned['rows'] = {};
    
    $.each(masteriesGlobalJSON.data, function(key, val) {
        //style="padding-top: 8vw; text-align: left; padding-left: 5vw; top: 5vs; left: 5vw;"
        //Set Total Assigned Points to zero.
        masteriesAssigned['total'] = 0;
        
        //Fill the assigned masteries with 0's.
        masteriesAssigned['points'][key] = 0;

        //Fill the assigned trees with 0's.
        masteriesAssigned['trees'][key[1]] = 0;

        //Fill the assigned rows with 0's.
        masteriesAssigned['rows'][key[1] + [key[2]]] = 0;
      });
        
    $.each(player.masteries, function(i, mastery) {
        masteriesAssigned['points'][mastery.masteryId] = mastery.rank;
        masteriesAssigned['total'] ++;
    });

    $.each(masteriesGlobalJSON.data, function(key, val) {
        drawMastery(key, masteriesAssigned, masteriesGlobalJSON);
      });
 
  }

  function drawMastery(key, masteriesAssigned, masteriesGlobalJSON) {
    //console.log(masteriesAssigned);
    //console.log(key);
    //console.log(masteriesAssigned.points[key]);

    var patch = document.getElementById("patchDisplay").innerHTML;
    var cleanedAssigned = masteriesAssigned['points'][key] == undefined ? 0 : masteriesAssigned['points'][key];
                          
    if (masteriesAssigned['points'][key] == masteriesGlobalJSON.data[key].ranks) {

    //Gold Icons
    
      var imgSrcMastery = "datadragon/" + patch + "/img/mastery/" + masteriesGlobalJSON.data[key].image.full;
      var imgStyleMastery = "width: 4vw; margin: .2vw; border: solid gold 1px;";
      var textStyleMastery = "border: solid gold 1px; color: gold; background-color: #222222; width: 3vw; margin-left: 1.5vw; margin-top: -1.0vw; position: relative; font-size: .8vw;";
      
    } else if (masteriesAssigned['points'][key] > 0) {
    
      //Gold Icons
      
      var imgSrcMastery = "datadragon/" + patch + "/img/mastery/" + masteriesGlobalJSON.data[key].image.full;
      var imgStyleMastery = "width: 4vw; margin: .2vw; border: solid lime 1px;";
      var textStyleMastery = "border: solid lime 1px; color: lime; background-color: #222222; width: 3vw; margin-left: 1.5vw; margin-top: -1.0vw; position: relative; font-size: .8vw;";
      
    } else {
    
      //Gray icons (No points assigned)
      var imgSrcMastery = "datadragon/" + patch + "/img/mastery/gray_" + masteriesGlobalJSON.data[key].image.full;
      var imgStyleMastery = "width: 4vw; margin: .2vw; border: solid gray 1px;";
      var textStyleMastery = "border: solid gray 1px; color: gray; background-color: #222222; width: 3vw; margin-left: 1.5vw; margin-top: -1.0vw; position: relative; font-size: .8vw;";
      
    }


    
    //I'll need to check if this should be gray or not here.
    
    var imageMastery = $("<img/>", {
       src: imgSrcMastery,
       style: imgStyleMastery,
       title: masteriesGlobalJSON.data[key].name + ": " + masteriesGlobalJSON.data[key].description[masteriesGlobalJSON.data[key].description.length - 1],

       
       onclick: "addMasteryPoint(" + key + ")"
       
       //html: JSON.stringify(masteriesGlobalJSON, null, '\t')
       
       });


    
    var pointsMastery = $("<div/>", {
     
        html: "<span id='ranks_" + key + "'>" + cleanedAssigned + "</span>&nbsp;&nbsp;/&nbsp;&nbsp;<span id='maxRanks_" + key + "'>" + masteriesGlobalJSON.data[key].ranks + "</span>",

        style: textStyleMastery
        
        });

    key = key.toString();

    
    //Map rows.
    
    var row = parseInt(key[2]) - 1;
    //Normalize Columns: Some Ferocity masteries appear in Column 4.
    var col = parseInt(key[3]) - 1 == 3 ? 2 : parseInt(key[3]) - 1;
    //Normalize Rows and Columns: All Cunning and Resolve masteries in even rows have their row's 2nd mastery in Column 2 instead of 3.
    col = parseInt(key[0]) > 0 && row % 2 == 0 && col == 1 ? 2 : col;

    
    if (key[1] == "1") {
      $('#ferocityHolder')[0].childNodes[0].rows[row].cells[col].innerHTML = "";
      imageMastery.appendTo($('#ferocityHolder')[0].childNodes[0].rows[row].cells[col]);
      pointsMastery.appendTo($('#ferocityHolder')[0].childNodes[0].rows[row].cells[col]);
      
    } else if (key[1] == "3") {
      $('#cunningHolder')[0].childNodes[0].rows[row].cells[col].innerHTML = "";
      imageMastery.appendTo($('#cunningHolder')[0].childNodes[0].rows[row].cells[col]);
      pointsMastery.appendTo($('#cunningHolder')[0].childNodes[0].rows[row].cells[col]);
      
    } else if (key[1] == "2") {
      $('#resolveHolder')[0].childNodes[0].rows[row].cells[col].innerHTML = "";
      imageMastery.appendTo($('#resolveHolder')[0].childNodes[0].rows[row].cells[col]);
      pointsMastery.appendTo($('#resolveHolder')[0].childNodes[0].rows[row].cells[col]);
      
    }
    //console.log($('#ferocityHolder')[0].childNodes[0]);
  }

  function hideMasteries() {
    document.getElementById('masteriesHolder').style.visibility = 'hidden';
  }
  
  function showMasteries() {
    document.getElementById('masteriesHolder').style.visibility = 'visible';
  }



  </script>

               
<div id='tableHolder'>          
  <table class='tableTeam' style='border: 1px solid #BBBBBB;' class='shadow_round current_match'>
    <thead>
      <tr class='fields'>
        <th><div style='width:7.8vw'>Summoner</div></th>
        <th><div style='width:4.75vw'>Recent Roles</div></th>
        <th><div style='width:9.1vw'>Champion (Games)</div></th>
        <th><div style='width:4.2vw' style='text-align:center;'>Rank</div></th>
        <!--<th><div style='width:4.2vw' style='text-align:center;'>Carry<br>Factor</div></th>-->
        <th><div style='text-align:center;width:4.2vw;'>Ranked<br>W/L</div></th>
        <th style='text-align:center'><div style='width:5.7vw'>KDA</div></th>
        <th style='text-align:center;'>Win %<br>(Games)</th>
        <th><div style='width: 10.4vw'>Runes</div></th><th>Masteries</th>
        <th>Cooldowns<br>(Testing)</th><th>Insight</th>
        <th>Counter<br> Power<span class='tooltip' title="Winrates for Plat+.&#013;  - The first black number is the champion's overall winrate for the given role.&#013;  - The BOLD Black Value is the overall win % for this champion in this matchup.&#013;  - The number in '( )' is the Counter Power.&#013;  - Counter power is the % difference between the average of the two champion win percents, and the matchup win %.&#013;  - Positive (Blue) values indicate this champion is statistically favored against their lane matchup.&#013;  - Negative (Red) values indicate their lane opponent is statistically favored in this matchup.&#013;  - Matchups must have 100+ games in Plat+ to be shown.">?</span></th>
      </tr>
    </thead>					
    <tbody class='current_match_tbody' id='current_match_team_$j'>                    
    
      <tr class='currentMatchPlayer' id='$champName' name='0'>
        <td class='tablePaneUpper'>                                                
          <div><a class='nameContainer' href='https://$region.op.gg/summoner/userName=$opggPlayerName' target='_blank'>Loading...</a></div>
          <div style='font-size:50%; '>Recent<br>&nbspNewest&nbsp&#8592;&#8594;&nbspOldest<br>
            <table class='recentWins' style='border-collapse: collapse;'>
              <tbody>
                <tr>
                  <!-- Recent Matches go here! (Generated by jQuery in ajax done function)-->


                </tr>
              </tbody>
            </table>
          </div>
        </td>
        <td style='font-size: 85%' class='tablePaneUpper recentRoles'>Roles</td>
        <td class='tablePaneUpper'>
          <table style='border-collapse: collapse;'>
            <tr>
              <td><a target='_blank'><img src='images/blank_square.png' alt='champ' style='width:2.8vw;' class='champPortraitMain'></a></td>
              <td>
                <div>
                  <a target='_blank'><img src='images/blank_square.png' alt='spell1' style='width:1.25vw;' class='sspell1'></a>
                </div>
                <div>
                  <a target='_blank'><img src='images/blank_square.png' alt='spell2' style='width:1.25vw;' class='sspell2'></a>
                </div>
              </td>
              <td>
                <div class='champNameContainer'>Champ</div>
                <div class='gamesPlayedContainer'>Games Played</div>
              </td>
            </tr>
          </table>
        </td>

        <td class='tablePaneUpper'><div style='text-align:center'><img src='/rankicons/unranked.png' class='center leagueIcon' alt='Rank' style='width:2vw'></div><div class='playerRank' style='text-align:center; font-size:85%'>League</div></td>
        <!--<td class='padleft' style='text-align:center;'><span>$carry<span class='tooltip' title='$carryString'>+</span></span></td>-->
        <td class='padleft' style='text-align:center;'><div class='seasonWinLoss'>Wins/Losses</div></td>
        <td class='tablePaneUpper' style='text-align:center'><div class='kdaContainer'>KDA<span class='tooltip' title='$everyoneKillsPerGame[$k]/$everyoneDeathsPerGame[$k]/$everyoneAssistsPerGame[$k]'>+</span></div></td>
        <td class='padleft' style='text-align:center;'><div class='winPctContainer'>Win Pct<br>(Games)</div></td>
        <td class='tablePaneUpper'><div style='font-size: 75%' class='runesDisplay'><!--Runes generated by ajax here.--></div></td>
        <td class='tablePaneUpper' style='text-align: center'><button id='$k' onclick='console.log("jquery onclick loadMasteries")' style='font-size:1vh' class='masteriesDisplay'>Masteries</button><div style='text-align: center; margin-top: .2vw;'><img class='keystoneDisplay' src='images/blank_square.png' alt='keystone' title='Keystone: $keystoneLabel' style='width:1.5vw;'></div></td>
        <td class='tablePaneUpper'><div class='cooldownDisplay' style='width:8vw; font-size:small;'>Cooldowns</div></td>
        <td class='tablePaneUpper' style='text-align: center;'><h3 class='insightDisplay'></h3></td>					
        <td class='tablePaneUpper counterPowerDisplay'>
          <div class='overallWinRate'>-</div>
          <div class='matchupWinRate'>-</div>
          <div>(<span class='counterPower'>-</span>)</div></td>
        
        </td>					
      </tr>
    </tbody>
  </table>

  <br>
  <div class='avgRankHolder' style="text-align:center;">Average Rank:</div>
  <br>

</div>

  

<div>
  <table id="masteriesHolder" class="masteriesHolder" style="visibility: hidden;">
    <tbody>
      <tr><td style="text-align: center;"><h5 style="display: inline-block;">Masteries</h5><button style="float:right; display: inline-block;" onclick="hideMasteries();" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect"><i class="material-icons">close</i></button></td></tr>
      <tr>
        <td class="masteriesHolder ferocity">
          <div>Ferocity</div>
          <div id="ferocityHolder" style="text-align: center;"></div>
          <!--<div style="padding-top: 8vw; text-align: left; padding-left: 5vw; top: 5vs; left: 5vw;">More Content</div>-->
        </td>
        <td class="masteriesHolder cunning">
          <div>Cunning</div>
          <div id="cunningHolder"></div>
        </td>
        <td class="masteriesHolder resolve">
          <div>Resolve</div>
          <div id="resolveHolder"></div>
        </td>
      </tr>
    </tbody>
  </table>
</div>
               
                
        </td>
        <td>
            <div id='skyscraperContainer2' style='height:600px; width: 160px;margin-left: 50px; background-color: #CFDFFF' class='shadow'>			
				<button style='float: left;' onclick="this.parentNode.remove();">X</button>
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
				<ins class="adsbygoogle"
					 style="display:inline-block;width:160px;height:600px; margin-right: 50px;"
					 data-ad-client="ca-pub-6399216573107712"
					 data-ad-slot="1622310788"></ins>
				<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
				</script>		
			</div>
            
        </td></tr></table>





                <span style='float:right;display:inline-block'><input type='checkbox' id='useDark' onclick='changeColors();'><span style='font-size:.72vw;font-weight:normal;vertical-align:top'>Dark Color Scheme</span></span>
        </div>

        <div style='text-align: center; margin: 0 auto'>Please Copy and Paste the URL (with Summoner Names) in the Lobby Chat!<span title='This supports our Website, and help your team WIN!' class='tooltip'>?</span></div>
        <br>

        <div style='width: 100%;' class='brown'><table><tr><td><img src="website/diamond_i.png" alt='diamond_i.png'></td><td style='width: 100%; font-size: 36px; text-align: center; color: #FFFFFF'>
                <div id="LeaderboardBottom"  style='box-shadow: 10px 10px 5px rgba(50, 50, 50, .6);width:728px;height:90px;text-align: center; margin: 0 auto' align='center'>
                                        <button style='float: left;' onclick="this.parentNode.remove();">X</button>
                                        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
                    <!-- Bottom Leaderboard Bronzodia -->
                    <ins class="adsbygoogle"
                         style="display:inline-block;width:728px;height:90px"
                         data-ad-client="ca-pub-6399216573107712"
                         data-ad-slot="7253070786"></ins>
                    <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                </div>
            </td><td><img src="website/diamond_i.png" alt='diamond_i.png' style="filter: fliph"></td></tr></table></div>
        <table style='text-align: center' align='center'><tr><td><a href='aboutus.html'>About us</a></td><td><a href="contact.html">Contact</a></td><td><a href="privacy_policy.html">Privacy Policy</a></td><td><a href="terms_of_use.html">Terms of Use</a></td><td><a href="credits.html">Credits</a></td><td><a href="https://www.reddit.com/user/NovaDisk1/">Reddit</a></td></tr></table>




        </div>  <!-- End main content div -->
		
		<script>
			
			var checkList = "" + 
				"<div style='font-size: x-small;'>" + 
				"<div>Mental Checklist:</div>" + 
				"<br>" + 
				"<div>Early Game:</div>" + 
				"<div>Statistical outliers?</div>" + 
				"<div>Runes/Masteries?</div>" + 
				"<div>Trade Mechanics?</div>" + 
				"<div>Jg Skirmishing power?</div>" + 
				"<div>Jungle paths?</div>" + 
				"<div>Posture okay?</div>" + 
				"<div>Hand in stable position?</div>" + 
				"<div>Level 1 invades?</div>" + 
				"<div>Power spikes?</div>" + 
				"<div>Which lanes have priority?</div>" + 
				"<div>Snowball potential?</div>" + 
				"<div>Who wants to roam?</div>" + 
				"<div>Should I TP or push?</div>" + 
				"<div>Am I safe to push?</div>" + 
				"<div>Or should I freeze?</div>" + 
				"<div>How long am I safe to push?</div>" + 
				"<div>Where is everybody?</div>" + 
				"<br>" + 
				"<div>Mid Game:</div>" + 
				"<div>Who is strong?</div>" + 
				"<div>Should we siege or pick?</div>" + 
				"<div>Should I group or split?</div>" + 
				"<div>Which team has more tanks?</div>" + 
				"<div>Who has initiation/pick?</div>" + 
				"<div>What's my job in skirmishes?</div>" + 
				"<div>What's my job on the map?</div>" + 
				"<div>Rotate, get Drake, or shove?</div>" + 
				"<br>" + 
				"<div>Late Game:</div>" + 
				"<div>How do teamfights work?</div>" + 
				"<div>What's my job?</div>" + 
				"<div>DPS? Zone? Protect? Initiate?</div>" + 
				"<div>Will I get zoned?</div>" + 
				"<div>Biggest threat to my carries?</div>" + 
				"<div>Biggest threat to me?</div>" + 
				"</div>";
				
				
			//Swap Ad Frame from left to right, randomly.
			if (new Date().getTime() % 2 == 0) {
				document.getElementById("skyscraperContainer2").innerHTML = checkList;
				
			} else {
				document.getElementById("skyscraperContainer").innerHTML = checkList;
				
			}
		</script>

<script>

  function init_sortable() {
    $( ".current_match_tbody" ).sortable({
      update: function(event, ui) {}
      });
    $( ".current_match_tbody" ).on( "sortupdate", function( event, ui ) {
        //Code to execute upon sorting.
        getCounterData();
        });

  }
			
  function getCounterData() {
    
    $.getJSON("/data/championsSummary.json", function(championsSummary){
        //"Vladimir":{"role":{"Top":{"percentPlayed":57.57,"winRate":"46.77"},"Middle":
        var roles = ["Top", "Jungle", "Middle", "ADC", "Support"];
	
        $.each(roles, function(k, role){

            var workingRow1 = $(".current_match_tbody:eq(0) > tr:eq(" + k + ")");
            var workingRow2 = $(".current_match_tbody:eq(1) > tr:eq(" + k + ")");

            var champ1 = workingRow1.find(".counterPowerDisplay").attr('name');

            if (championsSummary[champ1] == undefined) {
              workingRow1.find(".overallWinRate").html("Not enough data.");
              return true;

            }


            //console.log(champ1);
            //console.log(championsSummary);
            var champ1wr = parseFloat(championsSummary[champ1].role[role] != undefined? championsSummary[champ1].role[role].winRate : undefined);


            var champ2 = workingRow2.find(".counterPowerDisplay").attr('name');
            var champ2wr = parseFloat(championsSummary[champ2].role[role] != undefined? championsSummary[champ2].role[role].winRate : undefined);

            //console.log(champ1 + " vs " + champ2 + " " + roles[k] + ": " + champ1wr + ", " + champ2wr);


            //console.log(championsSummary[champ1].role[role]);

            if (championsSummary[champ1].role[role] != undefined) {
              workingRow1.find(".overallWinRate").html(champ1wr);
            } else {
              workingRow1.find(".overallWinRate").html('-');
            }

            if (championsSummary[champ2].role[role] != undefined) {
              workingRow2.find(".overallWinRate").html(champ2wr);
            } else {
              workingRow2.find(".overallWinRate").html('-');
            }

            if (champ1wr != undefined && champ2wr != undefined) {
              $.getJSON("/data/championgg/" + champ1 + '.json', function(counters) {
                  //console.log(counters);            
                  var matchupFound = false;
                  $.each(counters, function(i, champRole) {
                      if (champRole.role == roles[k]) {
                        //console.log("Roles match.");
                        $.each(champRole.matchups, function(j, matchup) {
                            if (matchup.key == champ2) {
                              //console.log("Found matchup!");
                              matchupFound = true;
                              workingRow1.find(".matchupWinRate").html(matchup.winRate);
                              workingRow2.find(".matchupWinRate").html(100 - matchup.winRate);

                              //console.log(champ1wr);
                              //console.log(champ2wr);
                              var counterPower = matchup.winRate - (champ1wr + champ2wr) / 2.0;

                              //console.log(matchup.winRate + " - (" + champ1wr + " + " + champ2wr + ") / 2.0");

                              //console.log( (champ1wr + champ2wr) / 2.0);
                              //console.log(counterPower);

                              workingRow1.find(".counterPower").html(Math.round(10.0 * counterPower) / 10.0);
                              workingRow1.find(".counterPower").attr('data', counterPower);
                              workingRow2.find(".counterPower").html(Math.round(-10.0 * counterPower) / 10.0);
                              workingRow2.find(".counterPower").attr('data', -counterPower);

                            }
                        });
                                        }
                  });

                 if (!matchupFound) {
                     workingRow1.find(".matchupWinRate").html('-');
                     workingRow2.find(".matchupWinRate").html('-');

                     workingRow1.find(".counterPower").html('-');
                     workingRow1.find(".counterPower").attr('data', '');
                     workingRow2.find(".counterPower").html('-');
                     workingRow2.find(".counterPower").attr('data', '');
 
                 }


              });
            }
        });// end each
    }); //end getJSON
    }

    </script>        
    <script src="src/carry-factor_Functions.js"></script>
    </body>

